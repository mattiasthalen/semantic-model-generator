---
phase: 01-project-foundation-build-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/semantic_model_generator/__init__.py
  - tests/__init__.py
  - tests/conftest.py
  - tests/test_placeholder.py
  - Makefile
  - .pre-commit-config.yaml
autonomous: true

must_haves:
  truths:
    - "`pip install -e .` succeeds and `import semantic_model_generator` works"
    - "`make lint` runs ruff and reports zero violations"
    - "`make typecheck` runs mypy in strict mode and passes"
    - "`make test` runs pytest and executes at least one passing test"
    - "`make check` runs lint + typecheck + test in sequence, all green"
    - "Pre-commit hooks block commits that fail ruff linting or have malformed commit messages"
    - "Package version is dynamically derived from git tags via hatch-vcs (not hardcoded)"
  artifacts:
    - path: "pyproject.toml"
      provides: "Build system config, tool configs for ruff/mypy/pytest/coverage"
      contains: "hatchling"
    - path: "src/semantic_model_generator/__init__.py"
      provides: "Package entry point"
      contains: "semantic_model_generator"
    - path: "Makefile"
      provides: "Developer convenience commands: lint, typecheck, test, check, install, clean"
      contains: "check: lint typecheck test"
    - path: ".pre-commit-config.yaml"
      provides: "Git hook configuration for ruff linting/formatting and conventional commits"
      contains: "conventional-pre-commit"
    - path: "tests/test_placeholder.py"
      provides: "At least one passing test to prove pytest works"
      contains: "def test_"
  key_links:
    - from: "pyproject.toml"
      to: "src/semantic_model_generator/_version.py"
      via: "hatch-vcs version-file directive generates _version.py at install time"
      pattern: "version-file.*_version.py"
    - from: "Makefile"
      to: "pyproject.toml"
      via: "make targets invoke tools configured in pyproject.toml (ruff, mypy, pytest)"
      pattern: "ruff check|mypy src|pytest"
    - from: ".pre-commit-config.yaml"
      to: "ruff"
      via: "pre-commit hooks run ruff check and ruff format on staged files"
      pattern: "ruff-pre-commit"
    - from: "pyproject.toml"
      to: "src/semantic_model_generator/"
      via: "hatchling wheel packages directive points to src layout"
      pattern: 'packages.*src/semantic_model_generator'
---

<objective>
Set up the complete Python package foundation with build system, quality tooling, and pre-commit hooks for the semantic-model-generator project.

Purpose: This is a greenfield project with zero source code. Before any domain logic can be written (Phase 2+), we need a working package that can be installed, linted, type-checked, and tested. Every subsequent phase depends on this foundation being solid.

Output: A fully configured Python package using hatchling + hatch-vcs with src layout, ruff linting, mypy strict type checking, pytest testing, and pre-commit hooks enforcing quality on every commit. Running `make check` proves the entire pipeline works.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation-build-system/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create package scaffold and all configuration files</name>
  <files>
    pyproject.toml
    src/semantic_model_generator/__init__.py
    tests/__init__.py
    tests/conftest.py
    tests/test_placeholder.py
    Makefile
    .pre-commit-config.yaml
  </files>
  <action>
Create the complete package scaffold with all configuration in one pass. The existing Makefile at the project root has only `help` and `claude` targets -- it must be replaced with the full development Makefile (preserving the existing `claude` target).

**1. pyproject.toml** -- Create at project root with ALL of the following sections:

Build system:
- `[build-system]` requires hatchling and hatch-vcs, backend is hatchling.build
- `[project]` with name "semantic-model-generator", dynamic version, description "Generate TMDL semantic models from Fabric warehouse metadata", requires-python ">=3.11", license MIT, empty dependencies list (runtime deps added in later phases)
- `[tool.hatch.version]` source = "vcs"
- `[tool.hatch.build.hooks.vcs]` version-file = "src/semantic_model_generator/_version.py"
- `[tool.hatch.build.targets.wheel]` packages = ["src/semantic_model_generator"]

Ruff config (all in pyproject.toml, NOT a separate ruff.toml):
- line-length = 100, target-version = "py311"
- lint select: E, W, F, I, B, C4, UP
- per-file-ignores: tests/**/*.py gets S101 ignored (allow assert)
- format: double quotes, space indent

Mypy config:
- python_version = "3.11", strict = true, warn_unused_configs = true
- Override for notebookutils.* and mssql.* modules: ignore_missing_imports = true

Pytest config:
- testpaths = ["tests"], addopts = ["--import-mode=importlib", "--strict-markers", "-ra"]

Coverage config:
- source = ["semantic_model_generator"], omit tests and _version.py

**2. src/semantic_model_generator/__init__.py** -- Create with a module docstring explaining the package purpose. Do NOT hardcode a __version__ string. Instead, use importlib.metadata to expose version:
```python
from importlib.metadata import PackageNotFoundError, version

try:
    __version__ = version("semantic-model-generator")
except PackageNotFoundError:
    __version__ = "0.0.0+unknown"
```
Add `__all__: list[str] = ["__version__"]` to satisfy mypy strict re-export rules.

**3. tests/__init__.py** -- Empty file (needed for pytest discovery with src layout in some configurations).

**4. tests/conftest.py** -- Create with a docstring "Shared test fixtures for semantic_model_generator tests." and no fixtures yet (placeholder for future phases).

**5. tests/test_placeholder.py** -- Create with a single test function `test_package_importable` that imports semantic_model_generator and asserts the module has a `__version__` attribute. This test proves both pytest and the package installation work. Add type annotations to the test function (returns None) to satisfy mypy strict.

**6. Makefile** -- Replace existing Makefile. Use TABS for indentation (critical -- Makefiles break with spaces). Include these targets:
- `help` (default) -- grep-based self-documenting help (preserve existing pattern)
- `claude` -- preserve existing `claude --dangerously-skip-permissions` target
- `install` -- `pip install -e ".[dev]"` then `pre-commit install --install-hooks` (BUT we are NOT using optional-dependencies for dev tools -- see note below)
- `lint` -- `ruff check src tests`
- `format` -- `ruff format src tests`
- `typecheck` -- `mypy src`
- `test` -- `pytest`
- `check` -- depends on lint, typecheck, test (runs all three in sequence). Print "All checks passed!" at end.
- `clean` -- remove build/, dist/, *.egg-info, .pytest_cache, .mypy_cache, .ruff_cache, __pycache__ dirs

For `install` target: Use `pip install -e .` then separate `pip install ruff mypy pytest pytest-cov pre-commit` (dev tools are NOT declared as project optional-dependencies per research recommendation -- they're installed separately to keep build-system.requires minimal). Update the install target to reflect this two-step approach.

**7. .pre-commit-config.yaml** -- Create at project root with:
- default_language_version: python: python3.11
- default_install_hook_types: [pre-commit, commit-msg] (BOTH stages -- this is critical for conventional commit validation to work)
- Repo: pre-commit/pre-commit-hooks (trailing-whitespace, end-of-file-fixer, check-yaml, check-added-large-files, check-merge-conflict)
- Repo: astral-sh/ruff-pre-commit with ruff (--fix flag) and ruff-format hooks
- Repo: compilerla/conventional-pre-commit with conventional-pre-commit hook at commit-msg stage, args: [--strict, feat, fix, docs, chore, test, refactor, ci, build, perf, style]

Use latest stable versions for hook repos. If exact versions from research are unavailable, use the latest available. The important thing is the hooks run -- version pinning can be updated.

NOTE on ruff-pre-commit rev: The research cites v0.15.0 which may not exist yet. Use the latest available tag. Check `pip install ruff` to see what version is available, then use the matching ruff-pre-commit rev (format: vX.Y.Z matching ruff version). If unsure, use `rev: v0.9.1` or latest stable.

NOTE on pre-commit-hooks rev: Research cites v6.0.0 which may not exist. Use v5.0.0 or latest available.
  </action>
  <verify>
Verify all files exist:
- `ls pyproject.toml src/semantic_model_generator/__init__.py tests/test_placeholder.py tests/conftest.py Makefile .pre-commit-config.yaml`
- `python -c "import tomllib; print(tomllib.load(open('pyproject.toml','rb'))['build-system'])"` confirms valid TOML and hatchling backend
- `grep -q 'check:.*lint.*typecheck.*test' Makefile` confirms check target chains correctly
  </verify>
  <done>
All 7 files exist with correct content. pyproject.toml is valid TOML with hatchling build backend, hatch-vcs versioning, ruff/mypy/pytest configs. Makefile has lint/typecheck/test/check/install/clean targets with tab indentation. .pre-commit-config.yaml has ruff + conventional-commit hooks. src layout has __init__.py with importlib.metadata version access.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install package, create git tag, and verify full pipeline</name>
  <files>
    src/semantic_model_generator/_version.py
  </files>
  <action>
This task installs the package, creates the initial version tag, installs pre-commit hooks, and verifies the entire quality pipeline works end-to-end. The _version.py file is auto-generated by hatch-vcs during installation -- do not create it manually.

**Step 1: Create initial git tag for dynamic versioning**

hatch-vcs derives the version from git tags. Without a tag, version resolution fails or produces "0.0.0". Create the initial tag:
```bash
git tag v0.0.1
```

NOTE: The tag must be created BEFORE `pip install -e .` so hatch-vcs can find it.

**Step 2: Install the package in editable mode**
```bash
pip install -e .
```

This should:
- Resolve hatchling as build backend
- Run hatch-vcs to generate src/semantic_model_generator/_version.py from git tag
- Install the package as editable

Verify: `python -c "import semantic_model_generator; print(semantic_model_generator.__version__)"` should print "0.0.1" (or "0.0.1.devN+hash" format).

**Step 3: Install development tools**
```bash
pip install ruff mypy pytest pytest-cov pre-commit
```

**Step 4: Run `make lint`**
```bash
make lint
```
Should report zero violations. If ruff finds issues in the scaffold files, fix them (likely trailing whitespace or import ordering). Iterate until clean.

**Step 5: Run `make typecheck`**
```bash
make typecheck
```
Should pass with zero errors. If mypy reports issues (likely around __init__.py or test files), fix them. Common issues:
- Missing return type on test functions (add `-> None`)
- `__all__` not declared
- importlib.metadata imports need proper typing

**Step 6: Run `make test`**
```bash
make test
```
Should discover and run tests/test_placeholder.py. At least 1 test must pass.

**Step 7: Run `make check`**
```bash
make check
```
Should run lint + typecheck + test in sequence, all green, ending with "All checks passed!"

**Step 8: Install pre-commit hooks**
```bash
pre-commit install --install-hooks
```

This installs both pre-commit and commit-msg hooks (because default_install_hook_types includes both).

**Step 9: Verify pre-commit runs**
```bash
pre-commit run --all-files
```

All hooks should pass on the current codebase. If any hook fails (trailing whitespace, end-of-file-fixer, ruff), fix the files and re-run until all pass.

**Troubleshooting guidance:**
- If hatch-vcs fails: ensure git tag exists (`git tag -l`), ensure .git directory exists
- If mypy fails on _version.py: the generated file may not have type annotations -- add a mypy override `[[tool.mypy.overrides]] module = "semantic_model_generator._version" allow_untyped_defs = true` if needed
- If pre-commit hook revs are not found: try different version tags. For ruff-pre-commit, the rev must match an actual release tag on GitHub. Run `pip show ruff` to get the installed version and use that as the rev.
- If conventional-pre-commit rev not found: try v3.4.0 or v3.2.0 as fallback versions
  </action>
  <verify>
Run each verification in sequence:
1. `python -c "import semantic_model_generator; print(semantic_model_generator.__version__)"` -- prints version (not "0.0.0+unknown")
2. `make lint` -- exits 0, no violations
3. `make typecheck` -- exits 0, "Success" message
4. `make test` -- exits 0, at least "1 passed"
5. `make check` -- exits 0, prints "All checks passed!"
6. `pre-commit run --all-files` -- exits 0, all hooks pass
  </verify>
  <done>
Package installs successfully via `pip install -e .` with dynamic version from git tag. `make check` passes (lint + typecheck + test all green). Pre-commit hooks are installed and pass on all files. The developer experience is: clone, `make install`, `make check` -- all green. Version is dynamically derived from git tags, not hardcoded.
  </done>
</task>

</tasks>

<verification>
Phase 1 success criteria verification (from ROADMAP.md):

1. `pip install -e .` succeeds and package importable as `semantic_model_generator`:
   ```bash
   pip install -e . && python -c "import semantic_model_generator"
   ```

2. `make lint` runs ruff and reports clean:
   ```bash
   make lint
   ```

3. `make typecheck` runs mypy in strict mode and passes:
   ```bash
   make typecheck
   ```

4. `make test` runs pytest and executes at least one passing test:
   ```bash
   make test
   ```

5. `make check` runs lint + typecheck + test in sequence, all green:
   ```bash
   make check
   ```

6. Pre-commit hook blocks commits that fail `make check` or have malformed commit messages:
   ```bash
   pre-commit run --all-files
   ```

7. Package version is dynamically derived from git tags:
   ```bash
   python -c "import semantic_model_generator; print(semantic_model_generator.__version__)"
   git tag -l  # should show v0.0.1
   ```
</verification>

<success_criteria>
- `make check` exits 0 (lint + typecheck + test all pass)
- `pre-commit run --all-files` exits 0 (all hooks pass)
- `python -c "import semantic_model_generator; print(semantic_model_generator.__version__)"` prints a version derived from git tag (not "0.0.0+unknown")
- Package uses src layout with hatchling build backend
- No hardcoded version strings anywhere in source
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation-build-system/01-01-SUMMARY.md`
</output>
